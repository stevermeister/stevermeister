{"id":3291,"date":"2017-03-13T03:17:22","date_gmt":"2017-03-13T01:17:22","guid":{"rendered":"http:\/\/stepansuvorov.com\/blog\/?p=3291"},"modified":"2019-05-23T17:10:16","modified_gmt":"2019-05-23T15:10:16","slug":"server-side-rendering-angular4","status":"publish","type":"post","link":"https:\/\/stepansuvorov.com\/blog\/2017\/03\/server-side-rendering-angular4\/","title":{"rendered":"\u0421\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433 \u0441 Angular4"},"content":{"rendered":"<p><strong>UPD<\/strong>: \u0421\u0442\u0430\u0442\u044c\u0441\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430 2017-04-24<\/p>\n<p>\u0421\u0442\u0430\u0442\u044c\u044f \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0430 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0430\/\u043f\u0435\u0440\u0435\u0440\u0430\u0431\u043e\u0442\u043a\u0438 <a href=\"https:\/\/www.softwarearchitekt.at\/post\/2017\/03\/07\/server-side-rendering-with-angular-4.aspx\">Server Side Rendering With Angular 4<\/a>.<\/p>\n<p>\u0427\u0442\u043e \u043d\u0430\u043c \u0434\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433?<\/p>\n<ul>\n<li>\u0431\u043e\u043b\u0435\u0435 \u0431\u044b\u0441\u0442\u0440\u0443\u044e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 &#8220;\u043f\u0435\u0440\u0432\u043e\u0433\u043e \u044d\u043a\u0440\u0430\u043d\u0430&#8221;<\/li>\n<li>\u043f\u043e\u0438\u0441\u043a\u043e\u0432\u0430\u044f \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f (\u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0438\u043a\u0438 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0445 \u0431\u043e\u0442\u043e\u0432)<\/li>\n<li>\u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0435\u0432\u044c\u044e \u0434\u043b\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0447\u0435\u043a<\/li>\n<\/ul>\n<p>\u0421 \u043f\u0435\u0440\u0432\u044b\u0445 \u0436\u0435 \u0434\u043d\u0435\u0439 <del>Angular2<\/del> <strong>Angular<\/strong> \u0432\u043a\u043b\u044e\u0447\u0430\u043b \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443 \u044d\u0442\u043e\u0439 \u043e\u043f\u0446\u0438\u0438 \u0432 \u0432\u0438\u0434\u0435 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u00a0<a href=\"https:\/\/universal.angular.io\/\">Angular Universal<\/a>. \u0422\u0430\u043a \u043a\u0430\u043a <strong>\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u043f\u0440\u0435\u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433<\/strong> \u043e\u0434\u043d\u0430 \u0438\u0437 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u043a\u0438\u043b\u043b\u0435\u0440-\u0444\u0438\u0447, \u0442\u043e \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 <strong>Angular 4<\/strong> \u0431\u044b\u043b\u043e \u043f\u0440\u0438\u043d\u044f\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0434\u043e\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0432\u043e \u0444\u0440\u0435\u043c\u0432\u043e\u0440\u043a.<\/p>\n<p><!--more--><\/p>\n<p>\u0412 \u044d\u0442\u043e\u0439 \u0441\u0442\u0430\u0442\u044c\u0435 \u043c\u044b \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0448\u0430\u0433\u0438 \u0447\u0442\u043e\u0431\u044b \u0440\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0435 Angular 4 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u0432 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433. \u041c\u044b \u0431\u0443\u0434\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e <a href=\"https:\/\/github.com\/webpack\/webpack\">webpack<\/a> \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e <a href=\"https:\/\/cli.angular.io\/\">Angular CLI<\/a>, \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u0440 \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0439\u0442\u0438 <a href=\"https:\/\/github.com\/stevermeister\/angular-ssr\">\u0442\u0443\u0442<\/a>.<\/p>\n<h2><\/h2>\n<h2>\u0414\u043e\u0441\u0442\u0430\u0435\u043c Webpack \u043a\u043e\u043d\u0444\u0438\u0433 \u0438\u0437 Angular CLI<\/h2>\n<p>\u0415\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435\u00a0Angular CLI, \u0442\u043e \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0437\u0432\u043b\u0435\u0447\u044c webpack \u043a\u043e\u043d\u0444\u0438\u0433 \u0434\u043b\u044f \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0439 \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0435\u0439 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438:<\/p>\n<pre><code>ng eject<\/code><\/pre>\n<p><span style=\"text-decoration: underline;\"><strong>\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435<\/strong><\/span><strong>!<\/strong>\u00a0\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u0432\u044b \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442\u0435 \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442\u00a0\u043a\u043e\u043c\u0430\u043d\u0434\u0430 <strong><a href=\"https:\/\/github.com\/angular\/angular-cli\/wiki\/eject\">ng eject<\/a><\/strong>.<\/p>\n<p>\u0412\u0430\u0440\u0438\u0430\u043d\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438(<strong>webpack.config.js<\/strong>) \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 CLI \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 <strong>Uglify<\/strong> \u043f\u043b\u0430\u0433\u0438\u043d\u0430, \u0430 <strong>AOT<\/strong> \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u044f \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0430, \u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0432\u043a\u043b\u044e\u0447\u0438\u043c \u043e\u0431\u0435 \u043e\u043f\u0446\u0438\u0438:<\/p>\n<pre>[javascript]\n[...]\n&quot;plugins&quot;: [\n\t[...],\n\tnew AotPlugin({\n          [...]\n\t  \/\/ \u0432\u043b\u044e\u0447\u0430\u0435\u043c AOT\n\t  &quot;skipCodeGeneration&quot;: false\n\t}),\n\n\t\/\/ \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c UglifyJsPlugin\n\tnew webpack.optimize.UglifyJsPlugin()\n]\n[...]\n[\/javascript]<\/pre>\n<p>\u0412 \u0442\u043e \u0432\u0440\u0435\u043c\u044f \u043a\u0430\u043a <strong>AOT<\/strong> \u0441\u043e\u0432\u0441\u0435\u043c \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430, \u043a\u043e\u043c\u0431\u0438\u043d\u0438\u0440\u0443\u044f \u044d\u0442\u0438 \u043e\u043f\u0446\u0438\u0438 \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u0434\u043e\u0431\u0438\u0442\u044c\u0441\u044f \u043f\u0440\u0435\u043a\u0440\u0430\u0441\u043d\u043e\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u0432 \u043f\u043b\u0430\u043d\u0435 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438.<\/p>\n<h2>\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u043f\u0430\u043a\u0435\u0442\u044b<\/h2>\n<p>\u0412\u0441\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0435 \u0434\u043b\u044f Angular \u0443\u0436\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043e \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e angular-cli, \u043a\u0440\u043e\u043c\u0435 \u043f\u0430\u043a\u0435\u0442\u0430\u00a0@angular\/animations, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u043c \u0432\u0440\u0443\u0447\u043d\u0443\u044e:<\/p>\n<pre>npm install --save @angular\/animations<\/pre>\n<p>\u0442\u0435\u043f\u0435\u0440\u044c \u043f\u043e\u0434\u0443\u043c\u0430\u0435\u043c \u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0435. \u00a0\u0412 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u043c \u0440\u0435\u0448\u0435\u043d\u0438\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f <a href=\"https:\/\/nodejs.org\/en\/\">node.js<\/a> \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 <a href=\"http:\/\/expressjs.com\/\">express<\/a>. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043c\u044b \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043c express c \u0435\u0433\u043e \u0442\u0438\u043f\u0430\u043c\u0438 \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 <strong>@angular\/platform-server<\/strong>:<\/p>\n<pre><code>npm i @angular\/platform-server@next --save\nnpm i express @types\/express --save\n<\/code><\/pre>\n<h2>\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0433\u043e\u00a0\u043c\u043e\u0434\u0443\u043b\u044f \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430<\/h2>\n<p>\u0414\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430 \u043d\u0430\u043c \u043d\u0443\u0436\u0435\u043d\u00a0\u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u043c\u043e\u0434\u0443\u043b\u044c, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 ServerModule. \u0421\u043e\u0433\u043b\u0430\u0441\u043d\u043e <a href=\"https:\/\/github.com\/robwormald\/ng-universal-demo\/\">\u043f\u0440\u0438\u043c\u0435\u0440\u0443 \u043e\u0442 Rob Wormald<\/a>, \u043c\u044b \u0442\u0430\u043a\u0436\u0435 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u043c\u043e\u0434\u0443\u043b\u044c \u043d\u0430\u0448\u0435\u0433\u043e \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f (\u0442\u043e\u0442 \u0447\u0442\u043e \u043e\u0442\u0440\u0438\u0441\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435):<\/p>\n<pre>[javascript]\n\/\/ app.server.module.ts\n\nimport { NgModule } from '@angular\/core';\nimport { ServerModule } from '@angular\/platform-server';\nimport { AppModule } from '.\/app.module';\nimport { AppComponent } from '.\/app.component';\n\n@NgModule({\n  imports: [\n\t  ServerModule,\n\t  AppModule\n  ],\n  bootstrap: [\n\t  AppComponent\n  ],\n  providers: [ ]\n})\nexport class AppServerModule {}\n[\/javascript]<\/pre>\n<p>\u0414\u0430\u043b\u0435\u0435 \u043c\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044c <strong>BrowserModule<\/strong> \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0443\u043a\u0430\u0437\u0430\u0432 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f (\u043f\u0440\u043e\u0441\u0442\u043e \u0441\u0442\u0440\u043e\u043a\u0430):<\/p>\n<pre>[javascript]\/\/ app.module.ts\n\n@NgModule({\n    imports: [\n        BrowserModule.withServerTransition({\n            appId: 'demo-app'\n        }),\n        HttpModule,\n        FormsModule,\n\t    [...]\n    ],\n    [...]\n})\nexport class AppModule {}[\/javascript]<\/pre>\n<h2>AOT \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430<\/h2>\n<p>\u0422\u0430\u043a \u043a\u0430\u043a\u00a0<strong>AotPlugin<\/strong> \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 AOT, \u043c\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440 Angular \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e, \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c <strong>tsconfig.server.json<\/strong> (\u043a\u043e\u043f\u0438\u044e <strong>tsconfig.json<\/strong>) \u0441\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c\u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c\u0438 <strong>angularCompilerOptions<\/strong>:<\/p>\n<pre><code>\"compilerOptions\": {\n    [...]\n},\n[...]\n\"angularCompilerOptions\": {\n  \"genDir\": \"src\/aot\",\n  \"entryModule\": \".\/src\/app.server.module#AppServerModule\"\n}<\/code><\/pre>\n<p>\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u043c \u0430\u043b\u0438\u0430\u0441 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0432 <strong>package.json<\/strong>:<\/p>\n<pre><code>[...]\n\"scripts\": {\n    [...]\n    \"ngc:server\": \"ngc -p tsconfig.server.json\"\n}\n[...]<\/code><\/pre>\n<p>\u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u0437\u043e\u0432\u0430<\/p>\n<pre><code>npm run ngc:server<\/code><\/pre>\n<p>\u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440 \u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 TypeScript \u0444\u0430\u0439\u043b\u044b \u0434\u043b\u044f \u043f\u0440\u043e\u0435\u043a\u0442\u0430.<\/p>\n<p>\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0414\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0435\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e\u00a0Angular CLI (&lt;1.0.0-rc.1), \u0442\u043e \u0432\u0430\u043c \u0435\u0449\u0435 \u043f\u0440\u0438\u0439\u0434\u0435\u0442\u0441\u044f \u0441\u0442\u0435\u0440\u0435\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0444\u0430\u0439\u043b\u0430\u00a0<strong>.\/src\/typings.d.ts<\/strong>:<\/p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"alignnone wp-image-3293\" src=\"https:\/\/stepansuvorov.com\/blog\/wp-content\/uploads\/2017\/03\/Screen-Shot-2017-03-13-at-00.02.05.png\" alt=\"\" width=\"465\" height=\"107\" \/><\/p>\n<p>\u0418\u043d\u0430\u0447\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443:\u00a0<em>Error at .\/src\/typings.d.ts:2:13: Subsequent variable declarations must have the same type. Variable &#8216;module&#8217; must be of type &#8216;NodeModule&#8217;, but here has type &#8216;{ id: string; }&#8217;.<\/em><\/p>\n<p>\u0422\u0435\u043f\u0435\u0440\u044c \u043c\u043e\u0436\u0435\u043c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 &#8211; <strong>main.server.ts<\/strong>, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439\u00a0<strong>AppServerModuleNgFactory<\/strong>:<\/p>\n<pre>[javascript]\n\/\/main.server.ts\nimport 'zone.js\/dist\/zone-node';\nimport { renderModuleFactory } from '@angular\/platform-server';\nimport { enableProdMode } from '@angular\/core';\nimport { AppServerModuleNgFactory } from '.\/aot\/src\/app\/app.server.module.ngfactory';\nimport * as express from 'express';\nimport * as fs from 'fs';\n\nfunction ngExpressEngine() {\n  return function (filePath, options, callback) {\n    renderModuleFactory(AppServerModuleNgFactory, {\n      document: fs.readFileSync(filePath).toString(),\n      url: options.req.url\n    }).then(string =&amp;amp;gt; {\n        callback(null, string);\n      });\n  };\n}\n\nenableProdMode();\n\nconst app = express();\napp.engine('html', ngExpressEngine());\n\napp.set('view engine', 'html');\napp.set('views', '.');\n\napp.get('\/', (req, res) =&amp;amp;gt; {\n  res.render('index', { req });\n});\n\napp.get('\/page2*', (req, res) =&amp;amp;gt; {\n  res.render('index', { req });\n});\n\napp.use(express.static('.'));\n\napp.listen(8000, () =&amp;amp;gt; console.log('listening...'));\n[\/javascript]<\/pre>\n<p>\u0423\u0431\u0435\u0434\u0438\u043c\u0441\u044f \u0447\u0442\u043e \u0432 \u0440\u043e\u0443\u0442\u0435\u0440\u0435 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \u0442\u0430\u043a\u0436\u0435 \u0435\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0435\u0439\u0442\u044b:<\/p>\n<pre>[javascript]\n\/\/app.module.ts\n    RouterModule.forRoot([\n      { path: '', component: HomeComponent, pathMatch: 'full' },\n      { path: 'page2', component: Page2Component }\n    ])\n[\/javascript]<\/pre>\n<h2>Webpack \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430<\/h2>\n<p>\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 webpack \u043a\u043e\u043d\u0444\u0438\u0433(<strong>webpack.server.config.js<\/strong>) \u0434\u043b\u044f \u0441\u0431\u043e\u0440\u043a\u0438 \u0431\u0430\u043d\u0434\u043b\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430, \u043e\u0442\u043b\u0438\u0447\u0438\u0435\u043c \u0431\u0443\u0434\u0443\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0441\u0442\u0440\u043e\u0447\u043a\u0438:<\/p>\n<pre><code>  \/\/ main.server.ts\n  \n  [...]\n  target: 'node',\n  [...]\n  \"entry\": {\n    \"main\": [\n      \".\/src\/main.server.ts\"\n    ]\n  },<\/code><\/pre>\n<p>\u0422\u0430\u043a \u043a\u0430\u043a \u043f\u043e\u0434\u0445\u043e\u0434 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0432\u0441\u0435\u0433\u043e \u043e\u0434\u0438\u043d \u0431\u0430\u043d\u0434\u043b, \u0442\u043e <strong>CommonsChunkPlugin<\/strong> \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u0440\u0435\u0437\u0430\u0442\u044c, \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u0443\u0431\u0440\u0430\u0442\u044c\u00a0<strong>NoEmitOnErrorsPlugin<\/strong>.<\/p>\n<p>\u0427\u0442\u043e\u0431\u044b \u043e\u0434\u0438\u043d \u0431\u0430\u043d\u0434\u043b \u043d\u0435 \u043f\u0435\u0440\u0435\u0442\u0438\u0440\u0430\u043b\u00a0\u0434\u0440\u0443\u0433\u043e\u0439, \u043c\u044b \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u0432\u044b\u0432\u043e\u0434 \u0432 \u0434\u0440\u0443\u0433\u043e\u0439 \u0444\u0430\u0439\u043b:<\/p>\n<pre><code>  \"output\": {\n    \"path\": path.join(process.cwd(), \"dist\"),\n    \"filename\": \"[name].server.bundle.js\",\n    \"chunkFilename\": \"[id].server.chunk.js\"\n  },<\/code><\/pre>\n<p>\u0438 \u0441\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c <strong>AotPlugin<\/strong>:<\/p>\n<pre><code>new AotPlugin({\n  \"entryModule\": __dirname + \"\/src\/app\/app.server.module.ts#AppServerModule\",\n  \"hostReplacementPaths\": {\n    \"environments\\\\environment.ts\": \"environments\\\\environment.ts\"\n  },\n  \"exclude\": [],\n  \"tsConfigPath\": \".\/tsconfig.server.json\",\n  \"skipCodeGeneration\": false\n}),<\/code><\/pre>\n<h2>\u0418\u0442\u043e\u0433\u043e<\/h2>\n<p>\u041a\u043e\u043c\u043f\u0438\u043b\u0438\u0440\u0443\u0435\u043c \u043a\u043b\u0438\u0435\u043d\u0442:<\/p>\n<pre><code>webpack<\/code><\/pre>\n<p>\u041a\u043e\u043c\u043f\u0438\u043b\u0438\u0440\u0443\u0435\u043c \u0441\u0435\u0440\u0432\u0435\u0440:<\/p>\n<pre><code>ngc -p tsconfig.server.json &amp;&amp; webpack --config webpack.server.config.js<\/code><\/pre>\n<p>\u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c<\/p>\n<pre><code>cd dist\nnode main.server.bundle.js<\/code><\/pre>\n<h2><strong>UPD:\u00a0<\/strong>\u041a\u0435\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 ngExpressEngine<\/h2>\n<p>\u0427\u0442\u043e\u0431\u044b \u043d\u0435 \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u043e\u0432\u0443\u044e \u0441\u0438\u0441\u0442\u0435\u043c\u0443, \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043a\u0435\u0448\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0447\u0442\u0435\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u0430:<\/p>\n<pre>[javascript]\nlet templateCache = {};\nfunction ngExpressEngine() {\n  return function (filePath, options, callback) {\n    if (!templateCache[filePath]) {\n      let file = fs.readFileSync(filePath);\n      templateCache[filePath] = file.toString();\n    }\n    renderModuleFactory(AppServerModuleNgFactory, {\n      document: fs.readFileSync(filePath).toString(),\n      url: options.req.url\n    }).then(string =&amp;amp;gt; {\n      callback(null, string);\n    });\n  };\n}\n[\/javascript]<\/pre>\n<h2><strong>UPD2: \u0423\u0434\u043e\u0431\u043d\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0434\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430<\/strong><\/h2>\n<p>\u041c\u044b \u043c\u043e\u0436\u0435\u043c \u043f\u0440\u043e\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0430\u043b\u0438\u0430\u0441-\u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432 package.json:<\/p>\n<pre><code>\"scripts\": {\n\t[...]\n\t\"build\": \"npm run build:client\",\n\t\"build:client\": \"webpack\",\n\t\"build:server\": \"ngc -p tsconfig.server.json &amp;&amp; webpack --progress --config webpack.server.config.js\",\n\t\"build:all\": \"npm run build:client &amp;&amp; npm run build:server\",\n\t[...]\n}<\/code><\/pre>\n<h2>UPD3: \u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0441\u00a0APP_BASE_HREF<\/h2>\n<p>\u0414\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f(app.server.module) \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c\u00a0<strong>APP_BASE_HREF<\/strong>:<\/p>\n<pre>providers:\u00a0[{provide:\u00a0APP_BASE_HREF,\u00a0useValue\u00a0:\u00a0'\/'\u00a0}]<\/pre>\n<p>\u0438\u043d\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430:<\/p>\n<pre>Error: No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.<\/pre>\n<h2>UPD4:\u00a02 \u043c\u043e\u0434\u0443\u043b\u044f \u0432 \u043e\u0434\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 \u043b\u043e\u043c\u0430\u044e\u0442 Angular CLI<\/h2>\n<p>\u0418 \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443:<\/p>\n<pre>Error locating module for declaration\n SilentError: Multiple module files found:<\/pre>\n<p>\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u0447\u0438\u043d\u0438\u0442\u044c \u043f\u0440\u0438\u0448\u043b\u043e\u0441\u044c \u0432\u043e \u0432\u0441\u0435\u0445 \u043c\u0435\u0441\u0442\u0430\u0445 \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c\u00a0<strong>app.server.module.ts<\/strong> \u0432\u00a0<strong>app.server-module.ts<\/strong><\/p>\n","protected":false},"excerpt":{"rendered":"<p>UPD: \u0421\u0442\u0430\u0442\u044c\u0441\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430 2017-04-24 \u0421\u0442\u0430\u0442\u044c\u044f \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0430 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0430\/\u043f\u0435\u0440\u0435\u0440\u0430\u0431\u043e\u0442\u043a\u0438 Server Side Rendering With Angular 4. \u0427\u0442\u043e \u043d\u0430\u043c \u0434\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433? \u0431\u043e\u043b\u0435\u0435 \u0431\u044b\u0441\u0442\u0440\u0443\u044e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 &#8220;\u043f\u0435\u0440\u0432\u043e\u0433\u043e \u044d\u043a\u0440\u0430\u043d\u0430&#8221; \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u0430\u044f \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f (\u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0438\u043a\u0438 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0445 \u0431\u043e\u0442\u043e\u0432) \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0435\u0432\u044c\u044e \u0434\u043b\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0447\u0435\u043a \u0421 \u043f\u0435\u0440\u0432\u044b\u0445 \u0436\u0435 \u0434\u043d\u0435\u0439 &hellip; <a href=\"https:\/\/stepansuvorov.com\/blog\/2017\/03\/server-side-rendering-angular4\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[4],"tags":[185,469,424,468],"_links":{"self":[{"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/posts\/3291"}],"collection":[{"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/comments?post=3291"}],"version-history":[{"count":6,"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/posts\/3291\/revisions"}],"predecessor-version":[{"id":3564,"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/posts\/3291\/revisions\/3564"}],"wp:attachment":[{"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/media?parent=3291"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/categories?post=3291"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/stepansuvorov.com\/blog\/wp-json\/wp\/v2\/tags?post=3291"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}